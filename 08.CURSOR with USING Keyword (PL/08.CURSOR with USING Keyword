CURSOR with USING Keyword (PL/SQL)

The USING keyword is used with OPEN cursor FOR when you pass bind values to a REF CURSOR (especially with dynamic SQL).

1Ô∏è‚É£ What is USING?

USING supplies runtime values to placeholders (:) inside the SQL statement opened by a REF CURSOR.

üëâ Mostly used with:

REF CURSOR
Dynamic SQL
OPEN cursor FOR

2Ô∏è‚É£ Why USING is Required?

To bind variables safely
To avoid SQL injection
To reuse SQL with different values
To pass input values to cursor queries

3Ô∏è‚É£ Basic Syntax

OPEN ref_cursor FOR
  SELECT column_list
  FROM table_name
  WHERE column = :bind_variable
USING value;

4Ô∏è‚É£ Simple Example (Single USING value)

DECLARE
  TYPE emp_cur IS REF CURSOR;
  v_cur emp_cur;

  v_empno emp.empno%TYPE := 7369;
  v_ename emp.ename%TYPE;
BEGIN
  OPEN v_cur FOR
    SELECT ename
    FROM emp
    WHERE empno = :empno
  USING v_empno;

  FETCH v_cur INTO v_ename;
  DBMS_OUTPUT.PUT_LINE(v_ename);

  CLOSE v_cur;
END;
/

üîë Key Point

:empno ‚Üí placeholder

USING v_empno ‚Üí actual value

5Ô∏è‚É£ Example with MULTIPLE USING Values
DECLARE
  TYPE emp_cur IS REF CURSOR;
  v_cur emp_cur;

  v_deptno NUMBER := 20;
  v_sal    NUMBER := 1000;

  v_name emp.ename%TYPE;
BEGIN
  OPEN v_cur FOR
    SELECT ename
    FROM emp
    WHERE deptno = :dno
    AND sal > :salary
  USING v_deptno, v_sal;

  LOOP
    FETCH v_cur INTO v_name;
    EXIT WHEN v_cur%NOTFOUND;

    DBMS_OUTPUT.PUT_LINE(v_name);
  END LOOP;

  CLOSE v_cur;
END;
/

6Ô∏è‚É£ USING with STRONG REF CURSOR (RETURN)

DECLARE
  TYPE emp_rec IS RECORD (
    empno emp.empno%TYPE,
    ename emp.ename%TYPE
  );

  TYPE emp_cur IS REF CURSOR RETURN emp_rec;

  v_cur emp_cur;
  v_emp emp_rec;
  v_dept NUMBER := 10;
BEGIN
  OPEN v_cur FOR
    SELECT empno, ename
    FROM emp
    WHERE deptno = :dno
  USING v_dept;

  LOOP
    FETCH v_cur INTO v_emp;
    EXIT WHEN v_cur%NOTFOUND;

    DBMS_OUTPUT.PUT_LINE(v_emp.empno || ' ' || v_emp.ename);
  END LOOP;

  CLOSE v_cur;
END;
/

‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå‚ùå--- SOLUTION ERROR 

| Cursor Type       | `RETURN` | `USING` |
| ----------------- | -------- | ------- |
| Weak REF CURSOR   | ‚ùå        | ‚úÖ       |
| Strong REF CURSOR | ‚úÖ        | ‚ùå       |



7Ô∏è‚É£ USING vs Hard Coding

‚ùå Bad Practice

OPEN v_cur FOR
  SELECT * FROM emp WHERE deptno = 10;


‚úÖ Good Practice

OPEN v_cur FOR
  SELECT * FROM emp WHERE deptno = :dno
USING v_dept;



8Ô∏è‚É£ Important Rules (Interview Focus)

Number of USING values must match bind variables
Order of USING values must match placeholder order
USING works only with REF CURSOR dynamic SQL
Not used in static CURSOR FOR LOOP

